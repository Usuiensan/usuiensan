<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shift-JIS ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .compatible { background-color: #d4edda; }
        .incompatible { background-color: #f8d7da; }
        .test-case { margin: 20px 0; padding: 15px; border-left: 4px solid #007bff; background: #f8f9fa; }
    </style>
</head>
<body>
    <h1>Shift-JIS äº’æ›æ€§ãƒã‚§ãƒƒã‚¯ ãƒ†ã‚¹ãƒˆ</h1>
    
    <div id="library-status"></div>
    
    <div class="test-case">
        <h3>ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹</h3>
        <button onclick="testShiftJIS()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <div id="test-results"></div>
    </div>

    <script src="https://unpkg.com/encoding-japanese@2.2.0/encoding.min.js"></script>
    <script>
        // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿çŠ¶æ³ã‚’ç¢ºèª
        function checkLibraryStatus() {
            const status = document.getElementById('library-status');
            const enc = (typeof Encoding !== 'undefined') ? Encoding : null;
            
            if (enc) {
                status.innerHTML = `
                    <div class="result compatible">
                        <strong>âœ“ encoding-japanese ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™</strong><br>
                        convert: ${typeof enc.convert === 'function' ? 'âœ“' : 'âœ—'}<br>
                        stringToCode: ${typeof enc.stringToCode === 'function' ? 'âœ“' : 'âœ—'}<br>
                        codeToString: ${typeof enc.codeToString === 'function' ? 'âœ“' : 'âœ—'}
                    </div>
                `;
            } else {
                status.innerHTML = `
                    <div class="result incompatible">
                        <strong>âœ— encoding-japanese ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“</strong>
                    </div>
                `;
            }
        }

        function testShiftJIS() {
            const testCases = [
                { text: 'ã‚ã„ã†ãˆãŠ', expected: 'compatible', desc: 'ã²ã‚‰ãŒãª' },
                { text: 'ã‚¢ã‚¤ã‚¦ã‚¨ã‚ª', expected: 'compatible', desc: 'ã‚«ã‚¿ã‚«ãƒŠ' },
                { text: 'æ¼¢å­—', expected: 'compatible', desc: 'åŸºæœ¬æ¼¢å­—' },
                { text: 'ABC123', expected: 'compatible', desc: 'ASCIIæ–‡å­—' },
                { text: 'ğŸ£ğŸº', expected: 'incompatible', desc: 'çµµæ–‡å­—' },
                { text: 'â‘ â‘¡â‘¢', expected: 'varies', desc: 'ä¸¸æ•°å­—ï¼ˆå®Ÿè£…ä¾å­˜ï¼‰' },
                { text: 'é«™ï¨‘', expected: 'varies', desc: 'ç•°ä½“å­—' }
            ];

            const results = document.getElementById('test-results');
            results.innerHTML = '<h4>ãƒ†ã‚¹ãƒˆçµæœ:</h4>';
            
            const enc = (typeof Encoding !== 'undefined') ? Encoding : null;
            
            testCases.forEach(testCase => {
                let result = 'ã‚¨ãƒ©ãƒ¼';
                let isCompatible = false;
                
                try {
                    if (enc) {
                        // æ–‡å­—åˆ—ã‚’æ–‡å­—ã‚³ãƒ¼ãƒ‰é…åˆ—ã«å¤‰æ›
                        const unicodeArray = enc.stringToCode(testCase.text);
                        
                        // Unicodeã‹ã‚‰Shift-JISã«å¤‰æ›
                        const sjisArray = enc.convert(unicodeArray, {
                            to: 'SJIS',
                            from: 'UNICODE'
                        });
                        
                        // Shift-JISã‹ã‚‰Unicodeã«æˆ»ã—ã¦æ¯”è¼ƒ
                        const restoredArray = enc.convert(sjisArray, {
                            to: 'UNICODE',
                            from: 'SJIS'
                        });
                        
                        const restored = enc.codeToString(restoredArray);
                        
                        isCompatible = (restored === testCase.text);
                        result = isCompatible ? 'äº’æ›æ€§ã‚ã‚Š' : 'äº’æ›æ€§ãªã—';
                        
                        console.log(`ãƒ†ã‚¹ãƒˆ "${testCase.text}":`, {
                            original: testCase.text,
                            unicode: unicodeArray,
                            sjis: sjisArray,
                            restored: restored,
                            compatible: isCompatible
                        });
                    } else {
                        result = 'ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæœªèª­ã¿è¾¼ã¿';
                    }
                } catch (e) {
                    result = `ã‚¨ãƒ©ãƒ¼: ${e.message}`;
                    console.error(`ãƒ†ã‚¹ãƒˆ "${testCase.text}" ã§ã‚¨ãƒ©ãƒ¼:`, e);
                }
                
                const resultClass = isCompatible ? 'compatible' : 'incompatible';
                results.innerHTML += `
                    <div class="result ${resultClass}">
                        <strong>${testCase.desc}</strong> "${testCase.text}": ${result}
                    </div>
                `;
            });
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªçŠ¶æ³ã‚’ãƒã‚§ãƒƒã‚¯
        document.addEventListener('DOMContentLoaded', checkLibraryStatus);
    </script>
</body>
</html>